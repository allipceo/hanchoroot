한양조씨 족보앱 데이터 스키마 v2.0
작성일: 2025.09.12
 작성자: 노팀장
 승인: 조대표
 버전: 2.0 (단순화 적용)
 주요 변경: 권한 관리 제거 + 읽기 전용 최적화

📊 데이터 구조 개요
기본 설계 원칙 (v2.0)
읽기 전용 JSON: 단방향 데이터 플로우
권한 관리 제거: 복잡한 canEdit 시스템 삭제
모바일 최적화: 114명 데이터 효율적 로딩
검색 최적화: 동명이인 처리 및 인덱싱
관리자 전담: 모든 수정은 노션에서
주요 데이터 엔티티 (단순화)
Person (개인 정보 - 권한 필드 제거)
SearchIndex (검색 최적화)
Config (앱 설정 - 관리자 정보만)
Metadata (메타 정보 - 단순화)

👤 Person 스키마 (v2.0 단순화)
기본 구조
{
  "id": "p_001",
  "name": "조정윤",
  "gender": "M",
  "generation": 1,
  "line": "common",
  "birthDate": "1852-03-05",
  "deathDate": "1940-06-14",
  "status": "deceased",
  "age": 88,
  "relationships": {
    "father": null,
    "mother": null,
    "spouses": ["p_002", "p_003"],
    "children": ["p_004", "p_005"]
  },
  "contact": {
    "phone": "",
    "email": "", 
    "address": ""
  },
  "additional": {
    "job": "",
    "notes": "한양조씨 시조",
    "photo": "",
    "burialPlace": "경기도 ○○묘원"
  }
  // ❌ permissions 필드 제거
  // ❌ canEdit 배열 제거  
  // ❌ lastUpdated, updatedBy 제거
}

필드 상세 설명
기본 정보
id: 고유 식별자 (p_001, p_002...)
name: 이름 (한글, 검색 키워드)
gender: 성별 (M/F)
generation: 세대 (1-6)
line: Line 분류 (Line1/Line2/Line3/common)
생존 정보
birthDate: 생년월일 (YYYY-MM-DD 또는 YYYY)
deathDate: 사망일 (null이면 생존)
status: 생존상태 (living/deceased/unknown)
age: 나이 또는 향년
관계 정보 (단순화)
relationships: 가족 관계 (ID 참조만)
spouses: 배우자 배열 (재혼 고려)
children: 자녀 배열 (ID 참조)

🔍 검색 최적화 스키마 (v2.0)
통합 검색 인덱스
{
  "searchIndex": {
    "byName": {
      "조정윤": [
        {
          "id": "p_001",
          "generation": 1,
          "line": "common", 
          "distinguisher": "시조"
        }
      ],
      "조윤희": [
        {
          "id": "p_023",
          "generation": 5,
          "line": "Line1",
          "father": "조성문",
          "spouse": "임준성",
          "birthYear": 1985
        },
        {
          "id": "p_045", 
          "generation": 5,
          "line": "Line2",
          "father": "조성용",
          "spouse": "양종원", 
          "birthYear": 1987
        },
        {
          "id": "p_067",
          "generation": 5,
          "line": "Line2",
          "father": "조성용", 
          "spouse": "양종원",
          "birthYear": 1987
        }
      ]
    },
    "byGeneration": {
      "1": ["p_001", "p_002", "p_003"],
      "2": ["p_004", "p_005", "p_006", "p_007", "p_008"],
      "3": ["p_009", "p_010", "p_011", "p_012", "p_013", "p_014", "p_015", "p_016", "p_017", "p_018", "p_019", "p_020"],
      "4": ["p_021", "p_022", "..."],
      "5": ["p_066", "p_067", "..."],
      "6": ["p_110", "p_111", "p_112", "p_113", "p_114"]
    },
    "byLine": {
      "Line1": ["p_004", "p_006", "p_009", "p_010", "..."],
      "Line2": ["p_004", "p_007", "p_013", "p_014", "..."],
      "Line3": ["p_005", "p_008", "p_017", "p_018", "..."],
      "common": ["p_001", "p_002", "p_003"]
    },
    "byStatus": {
      "living": ["p_020", "p_021", "p_066", "..."],
      "deceased": ["p_001", "p_002", "p_003", "..."],
      "unknown": ["p_089", "p_090"]
    }
  }
}

촌수 계산 매트릭스 (사전 계산)
{
  "kinshipMatrix": {
    "p_001": {
      "p_002": {"degree": 1, "relation": "spouse", "title": "부인"},
      "p_004": {"degree": 1, "relation": "son", "title": "아들"},
      "p_009": {"degree": 2, "relation": "grandson", "title": "손자"}
    },
    "p_004": {
      "p_001": {"degree": 1, "relation": "father", "title": "아버지"},
      "p_009": {"degree": 1, "relation": "son", "title": "아들"},
      "p_005": {"degree": 2, "relation": "brother", "title": "형제"}
    }
  }
}


⚙️ 앱 설정 스키마 (v2.0 단순화)
config.json
{
  "app": {
    "version": "1.0.0",
    "dataVersion": "v2.0",
    "lastUpdate": "2025-09-12T15:30:00Z"
  },
  "admin": {
    "name": "조대표",
    "phone": "010-1234-5678",
    "email": "admin@hanyang.com"
  },
  "settings": {
    "defaultLine": "Line1",
    "maxExportSize": 100,
    "cacheTimeout": 3600
  }
  // ❌ 복잡한 권한 관리 제거
  // ❌ password 필드 제거
  // ❌ secondary admin 제거 (필요시 나중에 추가)
}


📱 모바일 최적화 (v2.0)
데이터 분할 전략
core.js (필수 데이터, ~25KB)
const coreData = {
  persons: [
    // 1-3세대 기본 정보 (23명)
  ],
  searchIndex: {
    byName: { /* 전체 이름 인덱스 */ },
    byGeneration: { /* 세대별 ID 배열 */ }
  },
  kinshipMatrix: {
    // 핵심 관계만 (1-3세대)
  },
  config: { /* 앱 설정 */ }
};

extended.js (확장 데이터, ~35KB)
const extendedData = {
  persons: [
    // 4-6세대 상세 정보 (91명)
  ],
  fullKinshipMatrix: {
    // 전체 촌수 관계
  },
  contactDetails: {
    // 연락처 상세 정보
  }
};

지연 로딩 구현
class DataLoader {
  constructor() {
    this.coreLoaded = false;
    this.extendedLoaded = false;
  }
  
  async loadCore() {
    if (!this.coreLoaded) {
      const response = await fetch('data/core.js');
      this.coreData = await response.json();
      this.coreLoaded = true;
    }
    return this.coreData;
  }
  
  async loadExtended() {
    if (!this.extendedLoaded) {
      const response = await fetch('data/extended.js');
      this.extendedData = await response.json(); 
      this.extendedLoaded = true;
    }
    return this.extendedData;
  }
  
  // 필요에 따라 데이터 로드
  async getPerson(id) {
    if (id.startsWith('p_001') || id.startsWith('p_002') || id.startsWith('p_003')) {
      const core = await this.loadCore();
      return core.persons.find(p => p.id === id);
    } else {
      const extended = await this.loadExtended();
      return extended.persons.find(p => p.id === id);
    }
  }
}


🔄 노션 → JSON 변환 프로세스 (v2.0)
단순화된 변환 매핑
노션 필드
JSON 필드
변환 규칙
이름
name
직접 매핑
성별
gender
자동 추론 (조씨=M, 기타=F)
생년
birthDate
YYYY 또는 YYYY-MM-DD
세대
generation
숫자 변환
Line
line
문자열 (Line1/Line2/Line3/common)
배우자
spouses
배열 변환
아버지
relationships.father
ID 참조
어머니
relationships.mother
ID 참조

변환 스크립트 (단순화)
function convertNotionToJSON(notionData) {
  const persons = [];
  const searchIndex = {
    byName: {},
    byGeneration: {},
    byLine: {},
    byStatus: {}
  };
  
  // 1단계: 개인 정보 변환 (권한 필드 제외)
  notionData.forEach(person => {
    const jsonPerson = {
      id: generateId(person.이름, person.세대),
      name: person.이름,
      gender: determineGender(person.이름),
      generation: person.세대,
      line: person.Line || 'common',
      birthDate: convertDate(person.생년),
      deathDate: person.사망일 || null,
      status: determineStatus(person),
      relationships: buildRelationships(person),
      contact: {
        phone: person.연락처 || '',
        email: person.이메일 || '',
        address: person.주소 || ''
      }
      // ❌ permissions 필드 제거
    };
    persons.push(jsonPerson);
  });
  
  // 2단계: 검색 인덱스 생성
  buildSearchIndex(persons, searchIndex);
  
  // 3단계: 촌수 매트릭스 생성
  const kinshipMatrix = buildKinshipMatrix(persons);
  
  return {
    persons,
    searchIndex,
    kinshipMatrix,
    metadata: {
      totalCount: persons.length,
      generatedAt: new Date().toISOString(),
      version: '2.0'
    }
  };
}

// 성별 자동 추론 (단순화)
function determineGender(name) {
  return name.startsWith('조') ? 'M' : 'F';
}

// 생존 상태 추론
function determineStatus(person) {
  if (person.사망일) return 'deceased';
  if (person.세대 <= 2) return 'deceased'; // 1-2세대는 대부분 고인
  if (person.세대 >= 5) return 'living';   // 5-6세대는 대부분 생존
  return 'unknown'; // 3-4세대는 개별 확인 필요
}


🚀 성능 최적화 (v2.0)
메모리 사용량 최적화
Core 데이터: ~25KB (1-3세대 + 검색 인덱스)
Extended 데이터: ~35KB (4-6세대 + 상세 정보)
Total 최대: ~60KB (매우 효율적)
검색 성능
이름 검색: O(1) - 사전 구축된 해시 인덱스
세대별 필터: O(1) - 배열 직접 접근
촌수 계산: O(1) - 사전 계산된 매트릭스
동명이인 처리: O(1) - 인덱스에서 즉시 구별 정보 제공
캐싱 전략
// 브라우저 캐시 활용
const CACHE_KEYS = {
  CORE_DATA: 'hanyang_core_v2.0',
  EXTENDED_DATA: 'hanyang_extended_v2.0',
  USER_PREFERENCES: 'hanyang_user_prefs'
};

class CacheManager {
  static setCore(data) {
    localStorage.setItem(CACHE_KEYS.CORE_DATA, JSON.stringify(data));
  }
  
  static getCore() {
    const cached = localStorage.getItem(CACHE_KEYS.CORE_DATA);
    return cached ? JSON.parse(cached) : null;
  }
  
  static clearAll() {
    Object.values(CACHE_KEYS).forEach(key => {
      localStorage.removeItem(key);
    });
  }
}


🔒 데이터 무결성 (v2.0)
ID 생성 규칙
function generateId(name, generation) {
  // p_001, p_002, ... p_114 형식
  const index = getGlobalIndex(name, generation);
  return `p_${index.toString().padStart(3, '0')}`;
}

관계 검증
function validateRelationships(persons) {
  persons.forEach(person => {
    // 부모-자녀 관계 일관성 검증
    if (person.relationships.father) {
      const father = persons.find(p => p.id === person.relationships.father);
      if (!father.relationships.children.includes(person.id)) {
        console.warn(`관계 불일치: ${person.name} - ${father.name}`);
      }
    }
  });
}

데이터 백업
// JSON 생성 시 자동 백업
function generateJSONWithBackup(data) {
  const timestamp = new Date().toISOString().split('T')[0];
  const backupData = {
    ...data,
    backupInfo: {
      createdAt: timestamp,
      source: 'notion_database',
      version: '2.0'
    }
  };
  
  // GitHub에 백업 파일도 함께 저장
  return {
    main: data,
    backup: backupData
  };
}


📋 실제 데이터 구조 예시
1세대 조정윤 데이터
{
  "id": "p_001",
  "name": "조정윤", 
  "gender": "M",
  "generation": 1,
  "line": "common",
  "birthDate": "1852-03-05",
  "deathDate": "1940-06-14",
  "status": "deceased",
  "age": 88,
  "relationships": {
    "father": null,
    "mother": null, 
    "spouses": ["p_002", "p_003"],
    "children": ["p_004", "p_005"]
  },
  "contact": {
    "phone": "",
    "email": "",
    "address": ""
  },
  "additional": {
    "job": "",
    "notes": "한양조씨 시조, 1852년 출생",
    "photo": "",
    "burialPlace": "경기도 ○○묘원"
  }
}

5세대 조윤희 (동명이인) 데이터
[
  {
    "id": "p_023",
    "name": "조윤희",
    "gender": "F", 
    "generation": 5,
    "line": "Line1",
    "birthDate": "1985",
    "deathDate": null,
    "status": "living",
    "relationships": {
      "father": "p_015",
      "mother": "p_016",
      "spouses": ["p_024"],
      "children": ["p_025", "p_026"]
    }
  },
  {
    "id": "p_045",
    "name": "조윤희", 
    "gender": "F",
    "generation": 5,
    "line": "Line2",
    "birthDate": "1987",
    "deathDate": null, 
    "status": "living",
    "relationships": {
      "father": "p_030",
      "mother": "p_031",
      "spouses": ["p_046"],
      "children": []
    }
  }
]


🎯 v2.0의 핵심 개선사항
단순화로 인한 이점
✅ 권한 관리 복잡성 제거
✅ 데이터 구조 단순화
✅ 성능 최적화 극대화
✅ 개발 및 유지보수 용이성
기능성 유지
✅ 동명이인 완벽 처리
✅ 생존 여부 정확 표시
✅ 촌수 계산 최적화
✅ 검색 성능 극대화
문서 승인: 조대표
 v2.0 핵심: 단순화를 통한 안정성과 성능 극대화
 다음 단계: 실제 노션 데이터를 v2.0 스키마로 변환
009_
