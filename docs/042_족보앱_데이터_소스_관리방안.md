# 족보앱 개발을 위한 데이터 소스 관리방안

**문서 번호**: 042  
**작성일**: 2025년 1월 17일  
**작성자**: 서대리 (AI Assistant)  
**검토자**: 조대표님  
**버전**: 1.0  
**적용범위**: 한양조씨 족보앱 전체 프로젝트

---

## 📋 **문서 개요**

### **목적**
- 족보앱 개발에서 데이터 소스 관리의 최적화 방안 제시
- V2.0 방법론에 따른 "하나의 소스" 원칙 구현
- GitHub Pages 배포 환경에 최적화된 데이터 관리 체계 구축

### **배경**
- 기존 3개 데이터 소스(노션, JSON, window.CORE_DATA)로 인한 복잡성
- 데이터 불일치 및 동기화 문제 발생
- V2.0 방법론 원칙 3 "데이터 접근 표준화" 위반

---

## 🚨 **현재 문제점 분석**

### **1. 다중 데이터 소스 문제**
```
현재 상황:
노션 데이터베이스 → JSON 파일 → window.CORE_DATA → JavaScript 코드
     ↓              ↓              ↓              ↓
  조대표님 관리    중간 변환      브라우저 사용    실제 표시
```

#### **문제점:**
- **데이터 중복**: 같은 데이터가 3곳에 존재
- **동기화 복잡성**: 수정 시 3곳 모두 업데이트 필요
- **불일치 위험**: 어느 한 곳이라도 업데이트 안 되면 오류
- **관리 부담**: 조대표님이 노션만 수정해도 프로그램에서 반영 안 됨

### **2. V2.0 방법론 위반**
- **원칙 3 위반**: "모든 모듈이 동일한 방식으로 데이터 접근"
- **"하나의 소스" 원칙 위반**: 여러 데이터 소스 존재
- **데이터 접근 표준화 실패**: `window.CORE_DATA` 표준 미준수

### **3. GitHub Pages 배포 환경 제약**
- **정적 파일만 지원**: HTML, CSS, JavaScript
- **서버 사이드 코드 불가**: Node.js, API 서버 등
- **CORS 문제**: 브라우저에서 직접 API 호출 시 제약

---

## 🎯 **해결 방안: 2개 소스 통합**

### **최종 결정: 노션 + window.CORE_DATA**

#### **A. 노션 데이터베이스** (조대표님 관리)
- **역할**: 최상위 데이터 소스
- **관리**: 조대표님이 직접 수정
- **수정 권한**: 조대표님만
- **동기화**: 수정 시 자동으로 window.CORE_DATA 업데이트

#### **B. window.CORE_DATA** (프로그램 사용)
- **역할**: 브라우저에서 사용하는 데이터
- **형식**: JavaScript 객체
- **생성**: 노션에서 자동 변환
- **사용**: 모든 JavaScript 모듈에서 접근

### **제거 대상: JSON 파일**
- **converted_data.json**: 더 이상 필요 없음
- **중간 변환 과정**: 제거
- **복잡성 감소**: 단순한 구조

---

## 🏗️ **기술적 구현 구조**

### **데이터 흐름**
```
노션 데이터베이스 (최상위)
    ↓ (자동 동기화)
window.CORE_DATA (브라우저용)
    ↓ (직접 접근)
JavaScript 모듈들
├── search.js
├── detail.js
├── calculator.js
└── family.js
```

### **동기화 메커니즘**

#### **1. 자동 동기화 방법들**

##### **A. 노션 API 웹훅 (Webhook)**
```javascript
// 노션 데이터 변경 시 자동으로 알림
notion.webhooks.create({
  url: 'https://your-app.com/webhook',
  database_id: '2093284156fa404a911cbefa4b422994'
});
```

##### **B. 주기적 동기화 (Cron Job)**
```javascript
// 정해진 시간마다 노션 API 호출
setInterval(syncNotionToCoreData, 3600000); // 1시간마다
```

##### **C. 수동 동기화 버튼**
```javascript
// 조대표님이 버튼 클릭으로 동기화
function manualSync() {
  syncNotionToCoreData();
  alert('데이터 동기화 완료');
}
```

#### **2. 동기화 구현 코드**
```javascript
// 노션에서 최신 데이터 가져오기
async function syncNotionToCoreData() {
  try {
    const response = await notion.databases.query({
      database_id: '2093284156fa404a911cbefa4b422994'
    });
    
    // window.CORE_DATA 업데이트
    window.CORE_DATA = convertNotionToCoreData(response.results);
    
    console.log('노션 데이터 동기화 완료');
  } catch (error) {
    console.error('동기화 실패:', error);
  }
}

// 페이지 로드 시 자동 동기화
window.addEventListener('load', syncNotionToCoreData);
```

---

## 📊 **GitHub Pages 배포 환경 최적화**

### **장점 분석**

#### **1. V2.0 방법론 완벽 준수** ✅
- **환경 통일성**: 브라우저 환경에서 완전 작동
- **데이터 접근 표준화**: `window.CORE_DATA` 표준 사용
- **하나의 소스**: 노션 + window.CORE_DATA

#### **2. GitHub Pages 최적화** ✅
- **정적 파일**: JavaScript 객체로 완벽 지원
- **빠른 로딩**: 로컬 데이터로 즉시 로드
- **안정성**: 외부 API 의존성 없음

#### **3. 관리자 전용 수정** ✅
- **조대표님만 수정**: 노션에서만 데이터 변경
- **자동 동기화**: 수정 시 window.CORE_DATA 자동 업데이트
- **단순한 관리**: 복잡한 워크플로우 불필요

### **CORS 문제 해결 방안**

#### **방안 1: 프록시 서버 사용**
- **GitHub Pages**: 정적 파일만
- **별도 서버**: 노션 API 프록시 역할
- **결과**: CORS 문제 해결

#### **방안 2: 하이브리드 방식**
- **기본 데이터**: window.CORE_DATA (GitHub Pages)
- **업데이트**: 노션 API (선택적)
- **결과**: 안정성 + 실시간성

#### **방안 3: GitHub Actions 활용**
- **자동화**: 노션 변경 시 GitHub Actions가 window.CORE_DATA 업데이트
- **배포**: GitHub Pages에 자동 배포
- **결과**: 실시간성 + 안정성

---

## 🔄 **동기화 시나리오**

### **시나리오 1: 조대표님이 노션에서 데이터 수정**
1. **노션 수정**: 조대표님이 노션에서 "조은상" 상태를 "고인"으로 변경
2. **자동 감지**: 웹훅 또는 주기적 동기화가 변경 감지
3. **데이터 업데이트**: window.CORE_DATA 자동 업데이트
4. **즉시 반영**: 브라우저에서 "고인"으로 표시

### **시나리오 2: 수동 동기화**
1. **노션 수정**: 조대표님이 노션에서 데이터 수정
2. **동기화 버튼**: 관리자 페이지에서 "새로고침" 클릭
3. **즉시 업데이트**: window.CORE_DATA 즉시 업데이트

### **시나리오 3: GitHub Actions 자동화**
1. **노션 수정**: 조대표님이 노션에서 데이터 수정
2. **GitHub Actions**: 자동으로 노션 API 호출
3. **window.CORE_DATA 업데이트**: 새로운 데이터로 자동 생성
4. **GitHub Pages 배포**: 자동으로 배포

---

## 🎯 **장기적 이점**

### **1. 확장성**
- **새로운 기능**: window.CORE_DATA 기반으로 쉽게 추가
- **모듈화**: 각 기능이 동일한 데이터 소스 사용
- **일관성**: 모든 모듈이 동일한 데이터 구조

### **2. 유지보수성**
- **단순한 구조**: 2개 소스만 관리
- **자동 동기화**: 수동 작업 최소화
- **오류 감소**: 데이터 불일치 위험 최소화

### **3. 사용자 경험**
- **실시간 반영**: 노션 수정 → 즉시 프로그램 반영
- **빠른 로딩**: 로컬 데이터로 즉시 로드
- **안정성**: 외부 API 의존성 없음

### **4. 개발 효율성**
- **V2.0 방법론 준수**: 일관된 개발 원칙
- **GitHub Pages 최적화**: 배포 환경에 최적화
- **관리자 편의성**: 노션만 수정하면 됨

---

## 📋 **구현 단계**

### **1단계: 현재 문제 해결**
- [ ] JSON 파일과 window.CORE_DATA 필드명 일치
- [ ] JavaScript 코드를 새로운 필드명에 맞춰 수정
- [ ] 브라우저에서 정상 작동 확인

### **2단계: 노션 API 연동**
- [ ] 노션 API 키 설정
- [ ] 데이터베이스 ID 확인
- [ ] API 호출 테스트

### **3단계: 동기화 시스템 구축**
- [ ] 자동 동기화 함수 구현
- [ ] 수동 동기화 버튼 추가
- [ ] 오류 처리 및 로깅

### **4단계: GitHub Pages 배포**
- [ ] CORS 문제 해결
- [ ] 정적 파일 최적화
- [ ] 자동 배포 설정

### **5단계: 모니터링 및 최적화**
- [ ] 동기화 상태 모니터링
- [ ] 성능 최적화
- [ ] 사용자 피드백 반영

---

## 🚀 **결론**

### **핵심 메시지**
1. **노션 + window.CORE_DATA 2개 소스로 통합**
2. **V2.0 방법론 완벽 준수**
3. **GitHub Pages 환경 최적화**
4. **관리자 편의성 극대화**

### **기대 효과**
- **개발 효율성**: 3개 소스 → 2개 소스로 단순화
- **데이터 일관성**: 불일치 위험 최소화
- **관리 편의성**: 노션만 수정하면 자동 반영
- **확장성**: 새로운 기능 추가 용이

### **최종 권고사항**
**노션 + window.CORE_DATA 2개 소스 관리방안을 즉시 적용하여 V2.0 방법론의 "하나의 소스" 원칙을 완벽하게 구현하시기 바랍니다.**

---

**문서 완료일**: 2025년 1월 17일  
**다음 검토 예정일**: 2025년 2월 17일  
**문서 버전**: 1.0  
**승인**: 조대표님
