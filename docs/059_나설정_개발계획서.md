# 059. 나 설정(현재 사용자 확정) 개발계획서

작성일: 2025-01-17
작성자: 서대리

## A. 목표/원칙
- 원소스 데이터: `window.CORE_DATA`만 사용. 동명이인은 `id`로 해소.
- 레고블록 개발: 기존 검색/선택/매핑 로직 최대 재사용. 새로운 백엔드/DB 추가 없음.
- 무중단/안전: 스키마 변경 없이 브라우저 `localStorage`만 사용하여 저장/복원.
- 간결성: 첫 방문 한 번만 본인을 확정, 이후 자동 복원.

## B. 범위(기능)
- 첫 실행 시 “나 설정” 모달 자동 표시 → 본인 확정.
- ‘나→대상’ 계산에서 시작점 자동 적용.
- 헤더에 현재 사용자 표시 및 “나 변경” 기능 제공.

## C. 데이터/저장
- 저장소: `localStorage`
  - 키: `gia_current_user`
  - 값: `{ id, name }` (필수) — 추후 확장 `{ id, name, phone?, email? }`
- 로드 순서: `localStorage` 조회 → 없으면 모달 강제 표시.

## D. UI 구성
- 헤더 우측: `현재: {이름} (세대)` + `[나 변경]` 버튼.
- “나 설정” 모달:
  - 이름 입력(datalist, `CORE_DATA` 기반 자동완성)
  - 동명이인 목록(이름/세대/부 이름) 중 선택 → 확정
  - 확정 버튼은 유효 선택 시에만 활성화
- 오류/예외: 미존재/미선택 시 안내, 데이터 변경 시 재설정 요구 배너.

## E. 로직/재사용
- 인물 검색/매핑: `calculator_standalone.js`의 이름→ID 매핑 함수 재사용.
- 시작점 주입: `window.APP_CURRENT_USER = JSON.parse(localStorage.getItem('gia_current_user'))`.
- ‘나→대상’ 계산은 항상 `APP_CURRENT_USER.id`를 from으로 사용.

## F. 단계별 작업 체크리스트
1) 모달 컴포넌트 추가(`app/calculator.html`)
2) 이름 자동완성(datalist) 및 결과 리스트 렌더링
3) 선택 시 `{id,name}` 저장/복원 코드(`js/calculator_standalone.js`)
4) 헤더 표시/나 변경 버튼 연결
5) 예외 처리(캐시 삭제/데이터 변경 시 재설정 유도)
6) 테스트(최소 10케이스, 새로고침/재방문 복원 확인)
7) 문서화(사용 가이드 + 스크린샷)

## G. 성공 기준(Done)
- 첫 방문 모달로 본인 확정 → 재방문 시 자동 복원.
- ‘나→대상’ 계산에서 별도 입력 없이 바로 계산 가능.
- 헤더에 현재 사용자 노출, 변경 즉시 반영.

## H. 스코프 외/후속
- 연락처(전화/이메일) 수집은 현 단계 스코프 외. 알림/공유/2FA 등 기능 도입 시 스키마 확장 검토.
- 다중 기기 동기화 필요 시 Notion/외부 저장 연동 고려(후속).

## I. 일정(예상)
- 구현 0.5일, 테스트 0.5일, 문서화 0.5일 → 총 1.5일

## J. 리스크/대응
- 동명이인 혼동 → ID 기반 확정/표시로 해소.
- 데이터 갱신으로 ID 변경 → 재설정 배너 노출 및 가이드 제공.
