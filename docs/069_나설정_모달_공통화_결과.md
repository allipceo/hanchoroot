# 069_나설정 모달 공통화 결과

## 1. 개요
- 목적: “나 설정(현재 사용자 확정)” 기능을 공통 모달 컴포넌트로 통합하여 모든 화면에서 일관되게 사용
- 적용 화면: `index.html`(홈/설정), `search.html`(이름검색), 계산기 화면에서 필요 시 호출 가능
- 철학: 최소개발, 재사용, 단일 소스(로직 한 곳)

## 2. 구현 산출물
- `app/index.html`, `app/search.html`: 공통 모달 마크업 삽입(`id=me-modal`)
- `js/me_modal.js`: 공통 모달 로직(열기/닫기/검색/확정/초기화)
- 기존 코드와의 연동: `window.APP_CURRENT_USER` 동기화, `localStorage('gia_current_user')` 유지

### 2.1 주요 API
- `MeModal.open()`: 모달 열기 및 입력 포커스
- `MeModal.close()`: 모달 닫기
- 내부 동작: 입력 이벤트로 필터링 → 결과 클릭 시 확인창 → “나로 확정” 버튼 활성 → 확정 시 저장/동기화

## 3. 사용자 플로우(3채널)
1) 최초 실행: 저장된 사용자 없으면 MeModal.open() 호출(각 화면에서 필요 시 실행)
2) 촌수 계산: “나 필요” 상태에서 MeModal.open()으로 유도
3) 설정 화면: “나 설정” 항목 클릭 시 모달 오픈(홈에서 연결됨)

## 4. 테스트/시뮬레이션
- 시나리오 A(최초 실행)
  - localStorage에 `gia_current_user` 없음 → 모달 호출 시 정상 노출
  - 이름 입력 → 결과 클릭 → 확인창 “OO으로 설정하시겠습니까?” → 예 → “나로 확정” 활성화 → 저장됨
- 시나리오 B(설정에서 변경)
  - 설정 > 나 설정 클릭 → 모달 오픈 → 동일 절차로 변경 가능
- 시나리오 C(계산기 선행 조건)
  - 나 미설정 상태에서 계산 시 모달 유도(기존 로직과 호환)

결과: 3케이스 모두 App Current User가 정상 설정되고, 새로고침 후에도 유지 확인.

## 5. 디버깅/개선 사항
- 과거 이슈: 결과 클릭 후 버튼 활성화가 즉시 되지 않는 문제 → 공통 모달에서 확인창 후 `confirmBtn.disabled=false` 및 포커스 처리로 해결
- ID/이름 데이터 불일치 방지: 저장 시 `{id, name}` 저장하며, 화면 진입 시 점검 로직과 함께 사용 가능(필요 시 강화)

## 6. 사용법 요약
- 마크업: 각 페이지 하단에 다음 블록 포함
```html
<div id="me-modal" style="display:none"> ... </div>
<script src="../js/me_modal.js"></script>
```
- 호출: `MeModal.open()`
- 현재 사용자: `window.APP_CURRENT_USER` 참조(또는 `localStorage('gia_current_user')`)

## 7. 향후 개선(옵션)
- 모듈 로딩을 ES 모듈화(import)로 전환
- 관리자 설정(검증/예외 배너)과의 통합 인터페이스 제공
- 중복 이름/세대 필터링 UI 추가(예: “동명이인(L3/4세대)” 뱃지)

---
작성일: 2025-09-18
담당: 서대리
