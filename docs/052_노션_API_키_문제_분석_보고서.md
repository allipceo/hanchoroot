# 노션 API 키 문제 분석 보고서

**문서 번호**: 052  
**작성일**: 2025년 9월 14일  
**작성자**: 서대리  
**분석 대상**: GIA_KEY_01 vs GIA_KEY_02 API 키 문제  

---

## 1. 문제 개요

### 1.1 발생한 문제
- **ID 시스템 구축 과정**에서 노션 API 키 관련 문제 발생
- **GIA_KEY_02**로 계속 실패하다가 **GIA_KEY_01**로 전환 후 성공
- 단순한 필드 생성과 ID 부여 작업에 **과도한 시간과 노력 소모**

### 1.2 조대표님의 의문점
1. **GIA_KEY_01**은 검색과 수정이 모두 가능한가?
2. **GIA_KEY_02**는 검색만 가능한가?
3. **GIA_KEY_02**가 갑자기 유효성을 잃은 것인가?
4. 이전까지 잘 되던 API가 왜 갑자기 작동하지 않았는가?

---

## 2. 종합 테스트 결과

### 2.1 테스트 환경
- **테스트 시간**: 2025-09-14T23:14:03.970Z
- **데이터베이스 ID**: 2093284156fa404a911cbefa4b422994
- **테스트 항목**: 4가지 (스키마 조회, 데이터 쿼리, 페이지 업데이트, 실제 페이지 업데이트)

### 2.2 GIA_KEY_01 테스트 결과
| 테스트 항목 | 결과 | HTTP 상태 | 상세 |
|------------|------|-----------|------|
| **데이터베이스 스키마 조회** | ✅ 성공 | 200 | 족보 인물 데이터베이스 (14개 속성) |
| **데이터베이스 쿼리** | ✅ 성공 | 200 | 5개 결과 조회 성공 |
| **페이지 업데이트 (테스트)** | ❌ 실패 | 400 | 잘못된 UUID 형식 (예상된 실패) |
| **실제 페이지 업데이트** | ✅ 성공 | 200 | 조영하 페이지 업데이트 완료 |

### 2.3 GIA_KEY_02 테스트 결과
| 테스트 항목 | 결과 | HTTP 상태 | 상세 |
|------------|------|-----------|------|
| **데이터베이스 스키마 조회** | ❌ 실패 | 401 | API token is invalid |
| **데이터베이스 쿼리** | ❌ 실패 | 401 | API token is invalid |
| **페이지 업데이트 (테스트)** | ❌ 실패 | 401 | API token is invalid |
| **실제 페이지 업데이트** | ❌ 실패 | 401 | API token is invalid |

---

## 3. 문제 원인 분석

### 3.1 GIA_KEY_02의 상태
**결론**: **GIA_KEY_02는 완전히 무효화된 상태**

- **모든 API 호출에서 HTTP 401 오류 발생**
- **"API token is invalid" 메시지 일관성 있게 반환**
- **읽기/쓰기 모든 권한 상실**

### 3.2 GIA_KEY_01의 상태
**결론**: **GIA_KEY_02는 완전히 정상 작동**

- **읽기 권한**: ✅ 완전 정상
- **쓰기 권한**: ✅ 완전 정상
- **모든 API 엔드포인트 정상 작동**

### 3.3 API 키 무효화 가능한 원인들

#### 3.3.1 노션 측 정책 변경
- **API 키 만료 정책**: 일정 기간 후 자동 만료
- **보안 정책 강화**: 미사용 키 자동 비활성화
- **계정 정책 변경**: 통합 키 관리 방식 변경

#### 3.3.2 사용자 측 변경사항
- **노션 계정 설정 변경**: API 통합 설정 수정
- **권한 재설정**: 데이터베이스 접근 권한 변경
- **통합 키 재생성**: 기존 키 무효화 후 새 키 생성

#### 3.3.3 기술적 원인
- **API 버전 호환성**: Notion API 버전 업데이트
- **인증 방식 변경**: Bearer 토큰 인증 방식 변경
- **서버 측 문제**: 노션 서버 측 일시적 문제

---

## 4. 시간 낭비 원인 분석

### 4.1 문제 해결 과정의 비효율성

#### 4.1.1 잘못된 가정
- **"API 키가 유효하다"는 가정**: 조대표님이 데이터 접근 가능성을 근거로 제시
- **"권한 문제"라는 가정**: 읽기/쓰기 권한 차이로 오해
- **"환경 설정 문제"라는 가정**: .env 파일, Node.js 설정 등으로 오해

#### 4.1.2 불필요한 복잡화
- **과도한 디버깅**: API 키 자체 문제인데 환경 설정을 계속 수정
- **복잡한 스크립트 작성**: 단순한 문제를 복잡하게 접근
- **다양한 방법 시도**: fetch, https, axios 등 여러 방법 시도

### 4.2 올바른 접근법
1. **API 키 유효성 우선 확인**: 가장 기본적인 테스트부터 시작
2. **다른 API 키로 교체**: 문제가 지속되면 다른 키 시도
3. **단순한 테스트**: 복잡한 로직보다 기본 기능 테스트 우선

---

## 5. 교훈 및 개선 방안

### 5.1 즉시 적용할 개선사항

#### 5.1.1 API 키 관리
- **정기적 유효성 검사**: 주기적으로 API 키 상태 확인
- **백업 API 키 준비**: 여러 개의 API 키 보유
- **키별 용도 명확화**: 각 키의 사용 목적과 권한 문서화

#### 5.1.2 문제 해결 프로세스
- **기본부터 확인**: API 키 유효성 → 권한 → 환경 설정 순서
- **단순한 테스트 우선**: 복잡한 로직보다 기본 기능 테스트
- **빠른 대안 시도**: 문제가 지속되면 즉시 다른 방법 시도

### 5.2 장기적 개선 방안

#### 5.2.1 모니터링 시스템
- **API 키 상태 모니터링**: 자동화된 API 키 유효성 검사
- **알림 시스템**: API 키 문제 발생 시 즉시 알림
- **대체 키 자동 전환**: 주 키 실패 시 백업 키 자동 사용

#### 5.2.2 문서화 강화
- **API 키 관리 가이드**: 키 생성, 관리, 문제 해결 가이드
- **문제 해결 체크리스트**: API 문제 발생 시 단계별 해결 가이드
- **경험 사례 데이터베이스**: 과거 문제와 해결 방법 기록

---

## 6. 결론

### 6.1 문제의 본질
- **GIA_KEY_02**: 완전히 무효화된 상태 (모든 기능 불가)
- **GIA_KEY_01**: 완전히 정상 작동 (모든 기능 가능)
- **시간 낭비**: 잘못된 가정과 복잡한 접근법으로 인한 비효율

### 6.2 해결책
- **GIA_KEY_01 사용**: 현재 유일하게 작동하는 API 키
- **새로운 백업 키 생성**: 향후 문제 대비
- **문제 해결 프로세스 개선**: 기본부터 확인하는 체계적 접근

### 6.3 향후 대응
- **정기적 API 키 검증**: 월 1회 이상 유효성 확인
- **다중 키 관리**: 최소 2개 이상의 유효한 API 키 보유
- **빠른 대응 체계**: 문제 발생 시 즉시 대안 시도

---

**보고서 작성 완료**: 2025년 9월 14일  
**다음 검토 예정**: API 키 상태 정기 점검 시
