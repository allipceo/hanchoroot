# 촌수계산기 세부개발계획서

문서번호: 055  
작성일: 2025-09-15  
작성자: 서대리  
대상: 한양조씨 족보앱 V4.0 (단일소스: window.CORE_DATA)

---

## 1. 목표와 범위
- 목표: 두 인물 선택 시 촌수와 호칭(친/외 구분 포함)을 정확히 계산하여 UI에 표시
- 범위: 웹 클라이언트(프런트) 기능. 데이터 소스는 `window.CORE_DATA`만 사용. 기존 코드 재활용, 기존 화면에 영향 최소화
- 제약: 보안상 API 키 노출 금지. GIA_KEY_01은 서버 측에서만 사용(본 기능에선 사용 안 함)

---

## 2. 성공 기준 (Done 정의)
- [ ] 동일 라인/다른 라인 모두 계산 가능 (시조 기준 공통조상 탐색)
- [ ] 외가 규칙 반영(조씨가 아닌 경우 ‘외’ 접두) 및 친/외 호칭 구분
- [ ] 주요 케이스 자동 테스트 10건 이상 통과(형제·부모/자식·삼촌/조카·사촌·사촌조카·종조카 등)
- [ ] UI에서 두 사람 선택 → 결과(촌수 + 호칭) 즉시 표시, 오류 메시지 친절

---

## 3. 단계별 계획 (체크리스트)

### 3.1 단계 A: 엔진 안정화
- [ ] A1. 공통조상 탐색 함수 확정 (`findCommonAncestor`)  
- [ ] A2. 거리 계산 함수 확정 (`getDistanceToAncestor`)  
- [ ] A3. 외가 처리(조씨 아님 → 모계 조씨 환산 +1촌) 로직 확정  
- [ ] A4. 친/외 호칭 매핑 테이블 정리 (형제/사촌/삼촌·조카/사촌조카/종조카 등)  
- [ ] A5. 경계 케이스 처리(부모 정보 없음, 순환 방지, 최대 깊이)

### 3.2 단계 B: UI 연결 (간결·단단)
- [ ] B1. `chonsu.html` 입력 UI(두 사람 검색/선택, 계산 버튼)  
- [ ] B2. 결과 표시 컴포넌트(촌수, 호칭, 친/외 배지)  
- [ ] B3. 에러/안내 토스트(데이터 부족·미존재·다중동명이인 처리)

### 3.3 단계 C: 테스트/시뮬레이션
- [ ] C1. 테스트 케이스 세트 작성(실데이터 기반 10건 이상)  
- [ ] C2. 자동 스크립트 실행으로 회귀 테스트  
- [ ] C3. 성능 확인(1회 계산 < 50ms @ 152명 데이터)

### 3.4 단계 D: 통합/문서화
- [ ] D1. 메뉴/네비게이션 연동(기존 메뉴에 ‘촌수계산’ 연결)  
- [ ] D2. 사용자 가이드(예시 스크린샷, 주의사항)  
- [ ] D3. 릴리즈 노트/변경 파일 목록 정리

---

## 4. 설계 개요

### 4.1 데이터 가정
```js
// window.CORE_DATA.persons: Array<Person>
Person = {
  id, name, 성별, 세대, Line1,
  relationships: { father, mother, spouses: string[] }
}
```

### 4.2 계산 흐름
1) 두 인물 입력 → 2) 한양조씨 여부 판단 → 3) 외가 필요 시 모계 조씨로 대체, +1촌 가산  
4) 공통조상 탐색 → 5) 각 거리 합산 → 6) 친/외 호칭 매핑 → 7) 결과 반환/표시

### 4.3 호칭 매핑(요약)
- (1,1): 형제/자매 (친/외 접두)  
- (0,1),(1,0): 부모/자식  
- (1,2),(2,1): 삼촌/조카 (친/외)  
- (2,2): 사촌 (친/외)  
- (2,3),(3,2): 사촌삼촌/사촌조카 (친/외)  
- (1,3),(3,1): 종조부/종고모 · 종조카 (친/외)  
- 기타: “n촌 m세대 차이” 형식

---

## 5. 일정(예상)
- A 엔진 안정화: 1일  
- B UI 연결: 1일  
- C 테스트/시뮬: 0.5일  
- D 통합/문서화: 0.5일  
총 3일 (병행 가능 항목 병행 단축)

---

## 6. 위험 및 대응
- 동명이인: ID 우선 검색, 이름 충돌 시 선택 팝업 제공  
- 부모 정보 누락: “정보 부족” 안내 및 대체 경로 시도 제한  
- 성능: 방문 집합/최대깊이로 루프 방지, 캐시 도입 가능

---

## 7. 산출물
- chonsu_engine.js (계산 엔진)  
- chonsu.html / chonsu.js (UI)  
- tests/chonsu_cases.json (테스트 케이스)  
- docs/056_촌수계산기_완료보고서.md (완료 보고)

---

## 8. 비고
- 기존 코드 재활용 원칙 준수(간결·단단), window.CORE_DATA만 사용  
- UI 변경은 기존 레이아웃을 유지하며 최소 침습으로 탑재
