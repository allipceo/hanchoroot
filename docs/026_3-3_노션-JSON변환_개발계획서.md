# 3-3: 노션-JSON 변환 개발계획서

**작성일**: 2025년 1월 13일  
**작성자**: 서대리  
**단계**: 3-3단계 - 노션 데이터를 JSON으로 변환  
**문서번호**: 3-3

---

## 📋 **개발 목표**

### **핵심 목표**
- 노션 데이터베이스의 115명 인물 정보를 JSON 형태로 변환
- 019번 데이터 스키마에 맞는 구조로 데이터 정제 및 변환
- 기존 1-3단계 기능을 실제 데이터로 재검증 가능하도록 준비

### **성공 기준**
- ✅ 노션 API를 통한 115명 데이터 완전 추출
- ✅ 019번 스키마 구조에 맞는 JSON 변환 완료
- ✅ 관계 데이터 정확성 검증 완료
- ✅ 기존 1-3단계 기능과 완벽 호환

---

## 🎯 **개발 범위**

### **포함 기능**
1. **노션 API 연동**: 115명 인물 데이터 추출
2. **데이터 변환**: 노션 → JSON 구조 변환
3. **스키마 매핑**: 019번 스키마에 맞는 필드 매핑
4. **관계 데이터 정리**: 가족 관계 정보 정제
5. **ID 체계 적용**: G5F001D 형식 ID 생성
6. **검증 및 테스트**: 변환된 데이터 검증

### **제외 기능**
- 데이터 수정 권한 관리 (관리자만 수정)
- 실시간 동기화 (정적 JSON 파일 사용)
- 복잡한 관계 계산 (기본 관계만)

---

## 📅 **7단계 개발 계획**

### **3-3-1: 노션 API 연동 및 데이터 추출** (1시간 30분)
**목표**: 노션 데이터베이스에서 115명 인물 데이터 추출

**구현 내용**:
- 노션 API 키 및 데이터베이스 ID 확인
- PowerShell을 통한 API 호출 스크립트 작성
- 115명 인물 데이터 일괄 추출
- 데이터 구조 분석 및 필드 매핑 계획

**예상 결과물**:
- `notion_data_raw.json` (원본 노션 데이터)
- API 연동 스크립트

### **3-3-2: 데이터 구조 분석 및 스키마 매핑** (1시간)
**목표**: 노션 데이터를 019번 스키마에 맞게 매핑

**구현 내용**:
- 노션 필드와 019번 스키마 필드 매핑 테이블 작성
- 누락된 필드 식별 및 기본값 설정
- 관계 데이터 구조 분석
- ID 생성 규칙 적용

**예상 결과물**:
- 필드 매핑 테이블
- 데이터 변환 계획서

### **3-3-3: JSON 변환 스크립트 개발** (1시간 30분)
**목표**: 노션 데이터를 JSON으로 변환하는 스크립트 작성

**구현 내용**:
- Node.js 또는 Python 변환 스크립트 작성
- 필드 매핑 로직 구현
- 관계 데이터 변환 로직
- ID 생성 및 검증 로직

**예상 결과물**:
- `convert_notion_to_json.js` (변환 스크립트)
- 변환된 JSON 데이터

### **3-3-4: 관계 데이터 정리 및 검증** (1시간)
**목표**: 가족 관계 정보 정확성 검증 및 정리

**구현 내용**:
- 부모-자녀 관계 검증
- 형제자매 관계 정리
- 배우자 관계 확인
- 관계 데이터 무결성 검사

**예상 결과물**:
- 정제된 관계 데이터
- 관계 검증 보고서

### **3-3-5: Core Module 데이터 통합** (1시간)
**목표**: 변환된 데이터를 기존 Core Module에 통합

**구현 내용**:
- `data/core.js` 파일 업데이트
- 115명 데이터로 persons 배열 교체
- searchIndex 업데이트
- 기존 샘플 데이터 제거

**예상 결과물**:
- 업데이트된 `data/core.js`
- 통합된 데이터 구조

### **3-3-6: 기존 기능 재검증** (1시간)
**목표**: 실제 데이터로 1-3단계 기능 재테스트

**구현 내용**:
- 메인 화면 기능 테스트
- 검색 기능 테스트 (실제 115명 데이터)
- 촌수 계산 기능 테스트
- 성능 및 오류 검증

**예상 결과물**:
- 기능 재검증 보고서
- 발견된 이슈 및 해결 방안

### **3-3-7: 통합 테스트 및 문서화** (30분)
**목표**: 전체 시스템 통합 테스트 및 문서화

**구현 내용**:
- 전체 앱 통합 테스트
- 데이터 변환 과정 문서화
- 변환된 데이터 구조 문서화
- 다음 단계 개발 준비

**예상 결과물**:
- 통합 테스트 보고서
- 데이터 변환 문서
- 3-3단계 완료 보고서

---

## 🛠 **기술 구현 방안**

### **노션 API 연동**
```javascript
// PowerShell 스크립트 예시
$headers = @{
    "Authorization" = "Bearer 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"
    "Content-Type" = "application/json"
    "Notion-Version" = "2022-06-28"
}

$databaseId = "2093284156fa404a911cbefa4b422994"
$url = "https://api.notion.com/v1/databases/$databaseId/query"

$body = @{
    page_size = 100
} | ConvertTo-Json

$response = Invoke-RestMethod -Uri $url -Method Post -Headers $headers -Body $body
```

### **데이터 변환 구조**
```javascript
// 변환 스크립트 구조
const convertNotionToJSON = (notionData) => {
  return notionData.results.map(person => ({
    id: generateId(person),
    name: person.properties.이름?.title?.[0]?.text?.content || '',
    displayName: person.properties.이름?.title?.[0]?.text?.content || '',
    gender: inferGender(person),
    generation: parseInt(person.properties.세대?.number) || 0,
    line: person.properties.Line?.select?.name || 'Line1',
    birthDate: person.properties.생년?.date?.start || null,
    deathDate: person.properties.사망일?.date?.start || null,
    status: determineStatus(person),
    age: calculateAge(person),
    relationships: extractRelationships(person),
    contact: extractContact(person),
    additional: extractAdditional(person),
    tags: extractTags(person),
    stats: calculateStats(person),
    access: setAccess(person)
  }));
};
```

### **ID 생성 규칙**
```javascript
// G5F001D 형식 ID 생성
const generateId = (person) => {
  const generation = person.properties.세대?.number || 0;
  const gender = inferGender(person) === 'M' ? 'M' : 'F';
  const sequence = getSequenceNumber(person);
  const relation = getRelationCode(person);
  
  return `G${generation}${gender}${sequence.toString().padStart(3, '0')}${relation}`;
};
```

---

## 📊 **예상 데이터 구조**

### **변환 전 (노션)**
- 115명 인물 정보
- 6세대 구조
- 3개 Line 분류
- 기본 필드: 이름, 세대, Line, 생년, 사망일 등

### **변환 후 (JSON)**
```javascript
const CORE_DATA = {
  persons: [
    // 115명 인물 데이터
  ],
  searchIndex: {
    byName: { /* 115명 이름 인덱스 */ },
    byHanja: { /* 한자 이름 인덱스 */ },
    byGeneration: { /* 세대별 인덱스 */ },
    byLine: { /* Line별 인덱스 */ },
    byStatus: { /* 생존상태별 인덱스 */ },
    byTags: { /* 태그별 인덱스 */ }
  },
  searchHistory: { /* 검색 히스토리 */ },
  config: { /* 앱 설정 */ }
};
```

---

## ⚠️ **리스크 및 대응 방안**

### **주요 리스크**
1. **노션 API 제한**: 요청 횟수 제한
   - **대응**: 배치 처리 및 재시도 로직
2. **데이터 불일치**: 노션 필드명 변경
   - **대응**: 필드 매핑 테이블 유연하게 관리
3. **관계 데이터 오류**: 복잡한 가족 관계
   - **대응**: 수동 검증 및 수정 프로세스

### **백업 계획**
- API 실패 시: 수동 JSON 파일 생성
- 데이터 오류 시: 부분 변환 후 수동 보완
- 성능 이슈 시: 데이터 분할 처리

---

## 📈 **성공 지표**

### **정량적 지표**
- ✅ 115명 데이터 100% 추출
- ✅ 변환 성공률 95% 이상
- ✅ 기존 기능 호환성 100%
- ✅ 데이터 검증 통과율 100%

### **정성적 지표**
- 실제 가족 관계 정확성
- 검색 기능 정상 작동
- 촌수 계산 정확성
- 사용자 경험 개선

---

## 🔄 **개발 루틴**

### **각 단계별 프로세스**
1. **계획**: 단계별 상세 계획 수립
2. **개발**: 기능 구현
3. **시뮬레이션**: 샘플 데이터로 테스트
4. **실제 데이터**: 진짜 노션 데이터로 검증
5. **디버깅**: 오류 수정 및 최적화
6. **문서화**: 개발 결과 기록

### **간결함과 재활용성 원칙**
- 기존 1-3단계 구조 최대 활용
- 변환 스크립트 모듈화
- 재사용 가능한 유틸리티 함수 작성
- 모든 함수 100줄 이내 유지

---

## 📋 **체크리스트**

### **3-3-1 체크리스트**
- [ ] 노션 API 키 확인
- [ ] 데이터베이스 ID 확인
- [ ] API 호출 스크립트 작성
- [ ] 115명 데이터 추출 완료
- [ ] 원본 데이터 저장

### **3-3-2 체크리스트**
- [ ] 필드 매핑 테이블 작성
- [ ] 누락 필드 식별
- [ ] ID 생성 규칙 적용
- [ ] 관계 데이터 분석

### **3-3-3 체크리스트**
- [ ] 변환 스크립트 작성
- [ ] 필드 매핑 로직 구현
- [ ] 관계 데이터 변환
- [ ] ID 생성 및 검증

### **3-3-4 체크리스트**
- [ ] 부모-자녀 관계 검증
- [ ] 형제자매 관계 정리
- [ ] 배우자 관계 확인
- [ ] 관계 무결성 검사

### **3-3-5 체크리스트**
- [ ] core.js 파일 업데이트
- [ ] persons 배열 교체
- [ ] searchIndex 업데이트
- [ ] 샘플 데이터 제거

### **3-3-6 체크리스트**
- [ ] 메인 화면 테스트
- [ ] 검색 기능 테스트
- [ ] 촌수 계산 테스트
- [ ] 성능 검증

### **3-3-7 체크리스트**
- [ ] 통합 테스트 완료
- [ ] 문서화 완료
- [ ] 완료 보고서 작성
- [ ] 다음 단계 준비

---

**총 예상 소요시간**: 7시간  
**시작일**: 2025년 1월 13일  
**완료 목표일**: 2025년 1월 13일

---

**조대표님의 승인을 기다립니다!** 🚀
